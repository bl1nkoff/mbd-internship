# Тестовое задание для стажёра команды Mobile BigData от Блинкова Сергея
## Задание
Необходимо разработать сервис, который будет получать данные по уровню сигнала от пользователей и отображать в веб-приложении на карте в тайлах S2 уровня 15 две агрегатные метрики — средний уровень сигнала на тайл и количество уникальных пользователей в тайле.

## Высокоуровневое описание реализации
Пути url/data ожидаем данные, ввиде координат, user id и уровня сигнала. Для скорости хендлера просто проверяем это на заданные условия и отправляем в "сырую" базу данных
Когда по адресу /map приходят две крайние координаты видимого поля карты, запрашиваем обработку данных в "сырой" базе данных. По координатам из этих данных определяем клетку s2 15 уровня. В обычной базе хранятся данные отсортированные по клеткам, поэтому проверяем есть ли у нас такая клетка, если есть, то дополняем информацию о ней, если нет, то записываем, крайние координаты, координату центра(для быстрого определения находится ли тайл в зоне видимости, хотя можно сделать отбор грубее и просто проверять по дному из углов, конечно, можно и все углы проверять, но это неоправданно тяжелее) и наши данные от пользователя. В ответ на запрос отправляем массив клеток, который рисуем на гугл картах, подключенных через JS API. Чекбоксы сннизу отвечают за отображаемую метрику, так же для оптимизации обновление клеток только по кнопке.
Так же оставил автозаполнение случаными данными через страничку с картой- снизу кнопки запуска и остановки интервала с выводом в консоль. 

## Что получилось реализовать
* Приём данных заданной формы
```json
{
    "lat": 59.9355,
    "lon": 30.325623,
    "user_id": "98ea80cf-268a-474f-9ebb-5cc49b55365b",
    "signal": 20.68
}
```
* Отображение веб странички с картой (50%)
* Отображение тайлов на карте
* Изменение режима отображаемой метрики
* Вывод тайлов только в видимую область
* LvlDB
* Соблюдение заданных форматов данных

## Что не получилось реализовать
* Реализация очереди запросов, для повышения скорости запросов в секунду
* Корректное отображение страницы с картой- пропускаются css и js файлы
* Не везде возвращаются, или где-то возвращаются неверные статусы (исправленно в исходниках)
* Dockerfile (никогда с ним не работал, попытался, но он не может найти исполнительный файл, хотя ровно такой же алгоритм с FROM python и файлом на питоне работает)

## Про главную нереализованную проблему - запросы в минуту
С самого начала предположил, что запросы нужно отправлять в некую очередь, где потом уже своевременно обрабатывать их. Если не ошибаюсь с термином, то этим занимается диспатчер.Нашёл нужную библеотеку, но в ходе написания, вылезла ошибка, про которую написал далее.

## Ошибка, из-за которой, не получилось доделать и исправить
Всё это представляю как исправить, но после попытки перехода на версию  1.16.4, начала выскакивать ошибка:
```bash
> $ go build server.go
> server.go:14:2: no required module provides package github.com/golang/geo/s2: go.mod file not found in current directory or any parent directory; see 'go help modules'
> server.go:15:2: no required module provides package github.com/syndtr/goleveldb/leveldb: go.mod file not found in current directory or any parent directory; see 'go help modules'
```
Она не даёт скомпилировать файл. Потратил пол дня на это, но так и не смог решить, поэтому такие ошибки остались в скомпилированных версиях, которые исправлю в исходниках

Относительно её: все env переменные проверены, всё корректно. Другие репозитории замечательно скачиваются и работают. Пытался и вручную добавлять их, и чистить кэш, ничего не помогло.

## Запуск карты
Карта не запускается должным образом url/map в скомпилированной версии, её можно запустить html файлом по пути /html/map.html из корневой папки
